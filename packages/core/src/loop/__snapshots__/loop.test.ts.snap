// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`Loop Tests > AISDK v5 > generateText > result.files > should contain files 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "base64": "Hello World",
      "data": "Hello World",
      "mimeType": "text/plain",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "QkFVRw==",
      "data": "QkFVRw==",
      "mimeType": "image/jpeg",
    },
    "runId": "test-run-id",
    "type": "file",
  },
]
`;

exports[`Loop Tests > AISDK v5 > generateText > result.sources > should contain sources 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "123",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value",
        },
      },
      "sourceType": "url",
      "title": "Example",
      "url": "https://example.com",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "456",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value2",
        },
      },
      "sourceType": "url",
      "title": "Example 2",
      "url": "https://example.com/2",
    },
    "runId": "test-run-id",
    "type": "source",
  },
]
`;

exports[`Loop Tests > AISDK v5 > generateText > result.text > should generate text 1`] = `[]`;

exports[`Loop Tests > AISDK v5 > result.files > should contain files 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "base64": "Hello World",
      "data": "Hello World",
      "mimeType": "text/plain",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "QkFVRw==",
      "data": "QkFVRw==",
      "mimeType": "image/jpeg",
    },
    "runId": "test-run-id",
    "type": "file",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should filter out empty text deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should maintain conversation history in the llm input 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send delayed asynchronous tool results 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "result": "value-result",
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-result",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send files 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "Hello World",
      "data": "Hello World",
      "mimeType": "text/plain",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "QkFVRw==",
      "data": "QkFVRw==",
      "mimeType": "image/jpeg",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "data": "data:text/plain;base64,Hello World",
                      "filename": undefined,
                      "mediaType": "text/plain",
                      "type": "file",
                    },
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                    {
                      "data": "data:image/jpeg;base64,QkFVRw==",
                      "filename": undefined,
                      "mediaType": "image/jpeg",
                      "type": "file",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "data": "data:text/plain;base64,Hello World",
                      "filename": undefined,
                      "mediaType": "text/plain",
                      "type": "file",
                    },
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                    {
                      "data": "data:image/jpeg;base64,QkFVRw==",
                      "filename": undefined,
                      "mediaType": "image/jpeg",
                      "type": "file",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send reasoning deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
      "text": "I will open the conversation",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
      "text": " with witty banter.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
      "text": "",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "2",
      "providerMetadata": {
        "testProvider": {
          "redactedData": "redacted-reasoning-data",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "2",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": undefined,
      "text": " Once the user has relaxed,",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": undefined,
      "text": " I will pry for valuable information.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": undefined,
      "text": " I need to think about",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": undefined,
      "text": " this problem carefully.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": undefined,
      "text": " The best solution",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": undefined,
      "text": " requires careful",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": undefined,
      "text": " consideration of all factors.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hi",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": " there!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": "I will open the conversation with witty banter.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "redactedData": "redacted-reasoning-data",
                        },
                      },
                      "text": "",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": " Once the user has relaxed, I will pry for valuable information.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " I need to think about this problem carefully.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " The best solution requires careful consideration of all factors.",
                      "type": "reasoning",
                    },
                    {
                      "text": "Hi there!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hi there!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": "I will open the conversation with witty banter.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "redactedData": "redacted-reasoning-data",
                        },
                      },
                      "text": "",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": " Once the user has relaxed, I will pry for valuable information.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " I need to think about this problem carefully.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " The best solution requires careful consideration of all factors.",
                      "type": "reasoning",
                    },
                    {
                      "text": "Hi there!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hi there!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send sources 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "123",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value",
        },
      },
      "sourceType": "url",
      "title": "Example",
      "url": "https://example.com",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "456",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value2",
        },
      },
      "sourceType": "url",
      "title": "Example 2",
      "url": "https://example.com/2",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send text deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send tool call deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-input-streaming-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "{"",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "value",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "":"",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "Spark",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "le",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": " Day",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": ""}",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
    },
    "runId": "test-run-id",
    "type": "tool-call-input-streaming-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "Sparkle Day",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "Sparkle Day",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                      "toolName": "test-tool",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "cachedInputTokens": 3,
              "inputTokens": 3,
              "outputTokens": 10,
              "reasoningTokens": 10,
              "totalTokens": 23,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "Sparkle Day",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
            "toolName": "test-tool",
          },
        ],
        "usage": {
          "cachedInputTokens": 3,
          "inputTokens": 3,
          "outputTokens": 10,
          "reasoningTokens": 10,
          "totalTokens": 23,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "tool-calls",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "Sparkle Day",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                      "toolName": "test-tool",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "cachedInputTokens": 3,
              "inputTokens": 3,
              "outputTokens": 10,
              "reasoningTokens": 10,
              "totalTokens": 23,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "Sparkle Day",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
            "toolName": "test-tool",
          },
        ],
        "usage": {
          "cachedInputTokens": 3,
          "inputTokens": 3,
          "outputTokens": 10,
          "reasoningTokens": 10,
          "totalTokens": 23,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "tool-calls",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send tool calls 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": {
        "testProvider": {
          "signature": "sig",
        },
      },
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "providerOptions": {
                        "testProvider": {
                          "signature": "sig",
                        },
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": {
              "testProvider": {
                "signature": "sig",
              },
            },
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "providerOptions": {
                        "testProvider": {
                          "signature": "sig",
                        },
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": {
              "testProvider": {
                "signature": "sig",
              },
            },
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should send tool results 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "result": "value-result",
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-result",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.fullStream > should use fallback response metadata when response metadata is not provided 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-2000",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-2000",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-2000",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-2000",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "modelProvider": "mock-provider",
        "modelVersion": "v2",
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:02.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-2000",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "modelProvider": "mock-provider",
              "modelVersion": "v2",
              "timestamp": 1970-01-01T00:00:02.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-2000",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-2000",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "modelProvider": "mock-provider",
        "modelVersion": "v2",
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:02.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-2000",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "modelProvider": "mock-provider",
              "modelVersion": "v2",
              "timestamp": 1970-01-01T00:00:02.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.reasoning > should contain reasoning from model response 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
      "text": "I will open the conversation with witty banter.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "2",
      "providerMetadata": {
        "testProvider": {
          "redactedData": "redacted-reasoning-data",
        },
      },
      "text": "",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
      "text": " Once the user has relaxed, I will pry for valuable information.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
      "text": " I need to think about this problem carefully.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
      "text": " The best solution requires careful consideration of all factors.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.reasoningText > should contain reasoning text from model response 1`] = `"I will open the conversation with witty banter. Once the user has relaxed, I will pry for valuable information. I need to think about this problem carefully. The best solution requires careful consideration of all factors."`;

exports[`Loop Tests > AISDK v5 > result.response > should resolve with response information 1`] = `
{
  "dbMessages": [
    {
      "content": {
        "content": "Hello",
        "format": 2,
        "parts": [
          {
            "text": "Hello",
            "type": "text",
          },
        ],
      },
      "createdAt": 2024-01-01T00:00:00.001Z,
      "id": "msg-0",
      "role": "assistant",
    },
  ],
  "headers": {
    "call": "2",
  },
  "id": "id-0",
  "messages": [
    {
      "content": [
        {
          "text": "Hello",
          "type": "text",
        },
      ],
      "role": "assistant",
    },
  ],
  "modelId": "mock-model-id",
  "modelMetadata": {
    "modelId": "mock-model-id",
    "modelProvider": "mock-provider",
    "modelVersion": "v2",
  },
  "timestamp": 1970-01-01T00:00:00.000Z,
  "uiMessages": [
    {
      "id": "msg-0",
      "metadata": {
        "createdAt": 2024-01-01T00:00:00.001Z,
      },
      "parts": [
        {
          "text": "Hello",
          "type": "text",
        },
      ],
      "role": "assistant",
    },
  ],
}
`;

exports[`Loop Tests > AISDK v5 > result.sources > should contain sources 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "123",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value",
        },
      },
      "sourceType": "url",
      "title": "Example",
      "url": "https://example.com",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "456",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value2",
        },
      },
      "sourceType": "url",
      "title": "Example 2",
      "url": "https://example.com/2",
    },
    "runId": "test-run-id",
    "type": "source",
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.steps > should add the files from the model response to the step result 1`] = `
[
  {
    "content": [
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "Hello World",
          "mediaType": "text/plain",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
      {
        "text": "Hello!",
        "type": "text",
      },
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "QkFVRw==",
          "mediaType": "image/jpeg",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "Hello World",
          "mediaType": "text/plain",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "QkFVRw==",
          "mediaType": "image/jpeg",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
    ],
    "dynamicToolCalls": [],
    "dynamicToolResults": [],
    "files": [
      {
        "from": "AGENT",
        "payload": {
          "base64": "Hello World",
          "data": "Hello World",
          "mimeType": "text/plain",
        },
        "runId": "test-run-id",
        "type": "file",
      },
      {
        "from": "AGENT",
        "payload": {
          "base64": "QkFVRw==",
          "data": "QkFVRw==",
          "mimeType": "image/jpeg",
        },
        "runId": "test-run-id",
        "type": "file",
      },
    ],
    "finishReason": "stop",
    "providerMetadata": undefined,
    "reasoning": [],
    "reasoningText": "",
    "request": {},
    "response": {
      "headers": undefined,
      "id": "id-0",
      "messages": [
        {
          "content": [
            {
              "data": "data:text/plain;base64,Hello World",
              "filename": undefined,
              "mediaType": "text/plain",
              "type": "file",
            },
            {
              "text": "Hello!",
              "type": "text",
            },
            {
              "data": "data:image/jpeg;base64,QkFVRw==",
              "filename": undefined,
              "mediaType": "image/jpeg",
              "type": "file",
            },
          ],
          "role": "assistant",
        },
      ],
      "modelId": "mock-model-id",
      "modelMetadata": {
        "modelId": "mock-model-id",
        "modelProvider": "mock-provider",
        "modelVersion": "v2",
      },
      "modelProvider": "mock-provider",
      "modelVersion": "v2",
      "timestamp": 1970-01-01T00:00:00.000Z,
      "uiMessages": [
        {
          "id": "msg-0",
          "metadata": {
            "createdAt": 2024-01-01T00:00:00.001Z,
          },
          "parts": [
            {
              "mediaType": "text/plain",
              "type": "file",
              "url": "data:text/plain;base64,Hello World",
            },
            {
              "text": "Hello!",
              "type": "text",
            },
            {
              "mediaType": "image/jpeg",
              "type": "file",
              "url": "data:image/jpeg;base64,QkFVRw==",
            },
            {
              "mediaType": "text/plain",
              "type": "file",
              "url": "data:text/plain;base64,Hello World",
            },
            {
              "mediaType": "image/jpeg",
              "type": "file",
              "url": "data:image/jpeg;base64,QkFVRw==",
            },
          ],
          "role": "assistant",
        },
      ],
    },
    "sources": [],
    "staticToolCalls": [],
    "staticToolResults": [],
    "stepType": "initial",
    "text": "Hello!",
    "toolCalls": [],
    "toolResults": [],
    "tripwire": undefined,
    "usage": {
      "inputTokens": 3,
      "outputTokens": 10,
      "totalTokens": 13,
    },
    "warnings": [],
  },
]
`;

exports[`Loop Tests > AISDK v5 > result.text > should resolve with full text 1`] = `"Hello, world!"`;

exports[`Loop Tests > AISDK v5 > tool execution errors > should include tool error part in the full stream 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "error": [Error: test error],
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-error",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "test error",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "test error",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-1",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "output": {
                        "type": "text",
                        "value": "test error",
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-result",
                    },
                  ],
                  "role": "tool",
                },
                {
                  "content": [
                    {
                      "text": "I see the tool failed, let me help.",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": true,
        "reason": "tool-calls",
        "warnings": [],
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "I see the tool failed, let me help.",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "test error",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
          {
            "content": [
              {
                "text": "I see the tool failed, let me help.",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "test error",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
          {
            "content": [
              {
                "text": "I see the tool failed, let me help.",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-1",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-1",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "output": {
                        "type": "text",
                        "value": "test error",
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-result",
                    },
                  ],
                  "role": "tool",
                },
                {
                  "content": [
                    {
                      "text": "I see the tool failed, let me help.",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "I see the tool failed, let me help.",
        "toolCalls": [],
        "usage": {
          "inputTokens": 6,
          "outputTokens": 20,
          "totalTokens": 26,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": [],
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "test error",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
          {
            "content": [
              {
                "text": "I see the tool failed, let me help.",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "test error",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
          {
            "content": [
              {
                "text": "I see the tool failed, let me help.",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-1",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-1",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "output": {
                        "type": "text",
                        "value": "test error",
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-result",
                    },
                  ],
                  "role": "tool",
                },
                {
                  "content": [
                    {
                      "text": "I see the tool failed, let me help.",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "I see the tool failed, let me help.",
        "toolCalls": [],
        "usage": {
          "inputTokens": 6,
          "outputTokens": 20,
          "totalTokens": 26,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": [],
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v5 > tools with custom schema > should send tool calls 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v2",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.files > should contain files 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "base64": "Hello World",
      "data": "Hello World",
      "mimeType": "text/plain",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "QkFVRw==",
      "data": "QkFVRw==",
      "mimeType": "image/jpeg",
    },
    "runId": "test-run-id",
    "type": "file",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should filter out empty text deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should maintain conversation history in the llm input 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send delayed asynchronous tool results 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "result": "value-result",
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-result",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send files 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "Hello World",
      "data": "Hello World",
      "mimeType": "text/plain",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "base64": "QkFVRw==",
      "data": "QkFVRw==",
      "mimeType": "image/jpeg",
    },
    "runId": "test-run-id",
    "type": "file",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "data": "data:text/plain;base64,Hello World",
                      "filename": undefined,
                      "mediaType": "text/plain",
                      "type": "file",
                    },
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                    {
                      "data": "data:image/jpeg;base64,QkFVRw==",
                      "filename": undefined,
                      "mediaType": "image/jpeg",
                      "type": "file",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "data": "data:text/plain;base64,Hello World",
                "filename": undefined,
                "mediaType": "text/plain",
                "type": "file",
              },
              {
                "text": "Hello!",
                "type": "text",
              },
              {
                "data": "data:image/jpeg;base64,QkFVRw==",
                "filename": undefined,
                "mediaType": "image/jpeg",
                "type": "file",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "data": "data:text/plain;base64,Hello World",
                      "filename": undefined,
                      "mediaType": "text/plain",
                      "type": "file",
                    },
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                    {
                      "data": "data:image/jpeg;base64,QkFVRw==",
                      "filename": undefined,
                      "mediaType": "image/jpeg",
                      "type": "file",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send reasoning deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
      "text": "I will open the conversation",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
      "text": " with witty banter.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
      "text": "",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "2",
      "providerMetadata": {
        "testProvider": {
          "redactedData": "redacted-reasoning-data",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "2",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": undefined,
      "text": " Once the user has relaxed,",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": undefined,
      "text": " I will pry for valuable information.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": undefined,
      "text": " I need to think about",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": undefined,
      "text": " this problem carefully.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": undefined,
      "text": " The best solution",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": undefined,
      "text": " requires careful",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": undefined,
      "text": " consideration of all factors.",
    },
    "runId": "test-run-id",
    "type": "reasoning-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
    },
    "runId": "test-run-id",
    "type": "reasoning-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hi",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": " there!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": "I will open the conversation with witty banter.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "redactedData": "redacted-reasoning-data",
                        },
                      },
                      "text": "",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": " Once the user has relaxed, I will pry for valuable information.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " I need to think about this problem carefully.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " The best solution requires careful consideration of all factors.",
                      "type": "reasoning",
                    },
                    {
                      "text": "Hi there!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hi there!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": "I will open the conversation with witty banter.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "redactedData": "redacted-reasoning-data",
                  },
                },
                "text": "",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "1234567890",
                  },
                },
                "text": " Once the user has relaxed, I will pry for valuable information.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " I need to think about this problem carefully.",
                "type": "reasoning",
              },
              {
                "providerOptions": {
                  "testProvider": {
                    "signature": "0987654321",
                  },
                },
                "text": " The best solution requires careful consideration of all factors.",
                "type": "reasoning",
              },
              {
                "text": "Hi there!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": "I will open the conversation with witty banter.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "redactedData": "redacted-reasoning-data",
                        },
                      },
                      "text": "",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "1234567890",
                        },
                      },
                      "text": " Once the user has relaxed, I will pry for valuable information.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " I need to think about this problem carefully.",
                      "type": "reasoning",
                    },
                    {
                      "providerOptions": {
                        "testProvider": {
                          "signature": "0987654321",
                        },
                      },
                      "text": " The best solution requires careful consideration of all factors.",
                      "type": "reasoning",
                    },
                    {
                      "text": "Hi there!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hi there!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send sources 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "msg-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "123",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value",
        },
      },
      "sourceType": "url",
      "title": "Example",
      "url": "https://example.com",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "456",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value2",
        },
      },
      "sourceType": "url",
      "title": "Example 2",
      "url": "https://example.com/2",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "msg-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send text deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "response-id",
        "modelId": "response-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:05.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "response-id",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "response-model-id",
              "timestamp": 1970-01-01T00:00:05.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send tool call deltas 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-input-streaming-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "{"",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "value",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "":"",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "Spark",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": "le",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": " Day",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "argsTextDelta": ""}",
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
    },
    "runId": "test-run-id",
    "type": "tool-call-input-streaming-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "Sparkle Day",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
      "toolName": "test-tool",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "Sparkle Day",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                      "toolName": "test-tool",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "cachedInputTokens": 3,
              "inputTokens": 3,
              "outputTokens": 10,
              "reasoningTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "Sparkle Day",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
            "toolName": "test-tool",
          },
        ],
        "usage": {
          "cachedInputTokens": 3,
          "inputTokens": 3,
          "outputTokens": 10,
          "reasoningTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "tool-calls",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "Sparkle Day",
                },
                "providerExecuted": undefined,
                "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                "toolName": "test-tool",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "Sparkle Day",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
                      "toolName": "test-tool",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "cachedInputTokens": 3,
              "inputTokens": 3,
              "outputTokens": 10,
              "reasoningTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "Sparkle Day",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call_O17Uplv4lJvD6DVdIvFFeRMw",
            "toolName": "test-tool",
          },
        ],
        "usage": {
          "cachedInputTokens": 3,
          "inputTokens": 3,
          "outputTokens": 10,
          "reasoningTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "tool-calls",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send tool calls 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": {
        "testProvider": {
          "signature": "sig",
        },
      },
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "providerOptions": {
                        "testProvider": {
                          "signature": "sig",
                        },
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": {
              "testProvider": {
                "signature": "sig",
              },
            },
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "providerOptions": {
                  "testProvider": {
                    "signature": "sig",
                  },
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "providerOptions": {
                        "testProvider": {
                          "signature": "sig",
                        },
                      },
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": {
              "testProvider": {
                "signature": "sig",
              },
            },
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should send tool results 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-0",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-call",
  },
  {
    "from": "AGENT",
    "payload": {
      "args": {
        "value": "value",
      },
      "providerExecuted": undefined,
      "providerMetadata": undefined,
      "result": "value-result",
      "toolCallId": "call-1",
      "toolName": "tool1",
    },
    "runId": "test-run-id",
    "type": "tool-result",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-0",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "providerExecuted": undefined,
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-call",
              },
            ],
            "role": "assistant",
          },
          {
            "content": [
              {
                "input": {
                  "value": "value",
                },
                "output": {
                  "type": "text",
                  "value": "value-result",
                },
                "toolCallId": "call-1",
                "toolName": "tool1",
                "type": "tool-result",
              },
            ],
            "role": "tool",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-0",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:00.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-0",
              "messages": [
                {
                  "content": [
                    {
                      "input": {
                        "value": "value",
                      },
                      "providerExecuted": undefined,
                      "toolCallId": "call-1",
                      "toolName": "tool1",
                      "type": "tool-call",
                    },
                  ],
                  "role": "assistant",
                },
                {
                  "content": [],
                  "role": "tool",
                },
              ],
              "modelId": "mock-model-id",
              "timestamp": 1970-01-01T00:00:00.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "",
        "toolCalls": [
          {
            "args": {
              "value": "value",
            },
            "providerExecuted": undefined,
            "providerMetadata": undefined,
            "toolCallId": "call-1",
            "toolName": "tool1",
          },
        ],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.fullStream > should use fallback response metadata when response metadata is not provided 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "agent-id",
      "messageId": "id-2000",
    },
    "runId": "test-run-id",
    "type": "start",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-2000",
      "request": {},
      "warnings": [],
    },
    "runId": "test-run-id",
    "type": "step-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
    },
    "runId": "test-run-id",
    "type": "text-start",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "Hello",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": ", ",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "providerMetadata": undefined,
      "text": "world!",
    },
    "runId": "test-run-id",
    "type": "text-delta",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "text-1",
      "type": "text-end",
    },
    "runId": "test-run-id",
    "type": "text-end",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-2000",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-2000",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "modelProvider": "mock-provider",
        "modelVersion": "v3",
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:02.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-2000",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "modelProvider": "mock-provider",
              "modelVersion": "v3",
              "timestamp": 1970-01-01T00:00:02.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "step-finish",
  },
  {
    "from": "AGENT",
    "payload": {
      "messageId": "id-2000",
      "messages": {
        "all": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "nonUser": [
          {
            "content": [
              {
                "text": "Hello, world!",
                "type": "text",
              },
            ],
            "role": "assistant",
          },
        ],
        "user": [
          {
            "content": [
              {
                "text": "test-input",
                "type": "text",
              },
            ],
            "role": "user",
          },
        ],
      },
      "metadata": {
        "headers": undefined,
        "id": "id-2000",
        "modelId": "mock-model-id",
        "modelMetadata": {
          "modelId": "mock-model-id",
          "modelProvider": "mock-provider",
          "modelVersion": "v3",
        },
        "modelProvider": "mock-provider",
        "modelVersion": "v3",
        "providerMetadata": undefined,
        "request": {},
        "timestamp": 1970-01-01T00:00:02.000Z,
      },
      "output": {
        "steps": [
          DefaultStepResult {
            "content": [],
            "finishReason": undefined,
            "providerMetadata": undefined,
            "request": {},
            "response": {
              "headers": undefined,
              "id": "id-2000",
              "messages": [
                {
                  "content": [
                    {
                      "text": "Hello, world!",
                      "type": "text",
                    },
                  ],
                  "role": "assistant",
                },
              ],
              "modelId": "mock-model-id",
              "modelProvider": "mock-provider",
              "modelVersion": "v3",
              "timestamp": 1970-01-01T00:00:02.000Z,
            },
            "tripwire": undefined,
            "usage": {
              "inputTokens": 3,
              "outputTokens": 10,
              "totalTokens": 13,
            },
            "warnings": [],
          },
        ],
        "text": "Hello, world!",
        "toolCalls": [],
        "usage": {
          "inputTokens": 3,
          "outputTokens": 10,
          "totalTokens": 13,
        },
      },
      "processorRetryCount": 0,
      "processorRetryFeedback": undefined,
      "stepResult": {
        "isContinued": false,
        "reason": "stop",
        "warnings": undefined,
      },
    },
    "runId": "test-run-id",
    "type": "finish",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.reasoning > should contain reasoning from model response 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "id": "1",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
      "text": "I will open the conversation with witty banter.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "2",
      "providerMetadata": {
        "testProvider": {
          "redactedData": "redacted-reasoning-data",
        },
      },
      "text": "",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "3",
      "providerMetadata": {
        "testProvider": {
          "signature": "1234567890",
        },
      },
      "text": " Once the user has relaxed, I will pry for valuable information.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "4",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
      "text": " I need to think about this problem carefully.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
  {
    "from": "AGENT",
    "payload": {
      "id": "5",
      "providerMetadata": {
        "testProvider": {
          "signature": "0987654321",
        },
      },
      "text": " The best solution requires careful consideration of all factors.",
    },
    "runId": "test-run-id",
    "type": "reasoning",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.reasoningText > should contain reasoning text from model response 1`] = `"I will open the conversation with witty banter. Once the user has relaxed, I will pry for valuable information. I need to think about this problem carefully. The best solution requires careful consideration of all factors."`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.response > should resolve with response information 1`] = `
{
  "dbMessages": [
    {
      "content": {
        "content": "Hello",
        "format": 2,
        "parts": [
          {
            "text": "Hello",
            "type": "text",
          },
        ],
      },
      "createdAt": 2024-01-01T00:00:00.001Z,
      "id": "msg-0",
      "role": "assistant",
    },
  ],
  "headers": {
    "call": "2",
  },
  "id": "id-0",
  "messages": [
    {
      "content": [
        {
          "text": "Hello",
          "type": "text",
        },
      ],
      "role": "assistant",
    },
  ],
  "modelId": "mock-model-id",
  "modelMetadata": {
    "modelId": "mock-model-id",
    "modelProvider": "mock-provider",
    "modelVersion": "v3",
  },
  "timestamp": 1970-01-01T00:00:00.000Z,
  "uiMessages": [
    {
      "id": "msg-0",
      "metadata": {
        "createdAt": 2024-01-01T00:00:00.001Z,
      },
      "parts": [
        {
          "text": "Hello",
          "type": "text",
        },
      ],
      "role": "assistant",
    },
  ],
}
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.sources > should contain sources 1`] = `
[
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "123",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value",
        },
      },
      "sourceType": "url",
      "title": "Example",
      "url": "https://example.com",
    },
    "runId": "test-run-id",
    "type": "source",
  },
  {
    "from": "AGENT",
    "payload": {
      "filename": undefined,
      "id": "456",
      "mimeType": undefined,
      "providerMetadata": {
        "provider": {
          "custom": "value2",
        },
      },
      "sourceType": "url",
      "title": "Example 2",
      "url": "https://example.com/2",
    },
    "runId": "test-run-id",
    "type": "source",
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.steps > should add the files from the model response to the step result 1`] = `
[
  {
    "content": [
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "Hello World",
          "mediaType": "text/plain",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
      {
        "text": "Hello!",
        "type": "text",
      },
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "QkFVRw==",
          "mediaType": "image/jpeg",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "Hello World",
          "mediaType": "text/plain",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
      {
        "file": DefaultGeneratedFileWithType {
          "base64Data": "QkFVRw==",
          "mediaType": "image/jpeg",
          "type": "file",
          "uint8ArrayData": undefined,
        },
        "type": "file",
      },
    ],
    "dynamicToolCalls": [],
    "dynamicToolResults": [],
    "files": [
      {
        "from": "AGENT",
        "payload": {
          "base64": "Hello World",
          "data": "Hello World",
          "mimeType": "text/plain",
        },
        "runId": "test-run-id",
        "type": "file",
      },
      {
        "from": "AGENT",
        "payload": {
          "base64": "QkFVRw==",
          "data": "QkFVRw==",
          "mimeType": "image/jpeg",
        },
        "runId": "test-run-id",
        "type": "file",
      },
    ],
    "finishReason": "stop",
    "providerMetadata": undefined,
    "reasoning": [],
    "reasoningText": "",
    "request": {},
    "response": {
      "headers": undefined,
      "id": "id-0",
      "messages": [
        {
          "content": [
            {
              "data": "data:text/plain;base64,Hello World",
              "filename": undefined,
              "mediaType": "text/plain",
              "type": "file",
            },
            {
              "text": "Hello!",
              "type": "text",
            },
            {
              "data": "data:image/jpeg;base64,QkFVRw==",
              "filename": undefined,
              "mediaType": "image/jpeg",
              "type": "file",
            },
          ],
          "role": "assistant",
        },
      ],
      "modelId": "mock-model-id",
      "modelMetadata": {
        "modelId": "mock-model-id",
        "modelProvider": "mock-provider",
        "modelVersion": "v3",
      },
      "modelProvider": "mock-provider",
      "modelVersion": "v3",
      "timestamp": 1970-01-01T00:00:00.000Z,
      "uiMessages": [
        {
          "id": "msg-0",
          "metadata": {
            "createdAt": 2024-01-01T00:00:00.001Z,
          },
          "parts": [
            {
              "mediaType": "text/plain",
              "type": "file",
              "url": "data:text/plain;base64,Hello World",
            },
            {
              "text": "Hello!",
              "type": "text",
            },
            {
              "mediaType": "image/jpeg",
              "type": "file",
              "url": "data:image/jpeg;base64,QkFVRw==",
            },
            {
              "mediaType": "text/plain",
              "type": "file",
              "url": "data:text/plain;base64,Hello World",
            },
            {
              "mediaType": "image/jpeg",
              "type": "file",
              "url": "data:image/jpeg;base64,QkFVRw==",
            },
          ],
          "role": "assistant",
        },
      ],
    },
    "sources": [],
    "staticToolCalls": [],
    "staticToolResults": [],
    "stepType": "initial",
    "text": "Hello!",
    "toolCalls": [],
    "toolResults": [],
    "tripwire": undefined,
    "usage": {
      "inputTokens": 3,
      "outputTokens": 10,
      "totalTokens": 13,
    },
    "warnings": [],
  },
]
`;

exports[`Loop Tests > AISDK v6 (V3 models) > result.text > should resolve with full text 1`] = `"Hello, world!"`;
